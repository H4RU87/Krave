<!DOCTYPE html>
<html lang="en">
<head>
  <% include ../partials/head %>
    <style>
   #map {
      width: 500px;
      height: 400px;
      background-color: #CCC;
      float: right;
    }
    </style>

    <script type="text/javascript" src="/javascripts/test.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.js"></script>

    <script>
      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

      // Retrive and set place info on page
      function setPlaceInfo (name, address, phone, hours, website) {
          $('#name').text('Name: ' + name);
          $('#address').text('Address: ' + address);
          $('#phone').text('Phone: ' + phone);
          $('#hours').text('Hours: ' + hours);
          $('#website').text('Website: ' + website);
      }

      // Initialize Map
      function initMap() {
        var infowindow = new google.maps.InfoWindow();
        var service = new google.maps.places.PlacesService(map);

        service.getDetails({
          placeId: 'ChIJfTK9iWcE9YgRbZH2RIa6Ajc'
        }, function(place, status) {
          if (status === google.maps.places.PlacesServiceStatus.OK) {

            var map = new google.maps.Map(document.getElementById('map'), {
              center: place.geometry.location,
              zoom: 15
            });

            var marker = new google.maps.Marker({
              map: map,
              position: place.geometry.location
            });

            var d = new Date();
            var n = d.getDay();

            var open_to_close = place.opening_hours.periods[n].open.time + ' - ' + place.opening_hours.periods[n].close.time;

            setPlaceInfo(place.name, place.formatted_address, place.formatted_phone_number, open_to_close, place.website);

            google.maps.event.addListener(marker, 'click', function() {
              infowindow.setContent('<div><strong>' + place.name + '</strong><br>' +
              'Place ID: ' + place.place_id + '<br>' +
              place.formatted_address + '<br>' + place.formatted_phone_number + '<br>' + place.opening_hours.periods[0].open.time + ' - ' + place.opening_hours.periods[0].close.time  + '<br>' + place.website + '<br>');
              infowindow.open(map, this);
            });
          }
        });
      }
    </script>

</head>

<body class="container-fluid">
  <header>
    <% include ../partials/header %>
  </header>

  <main>

    <div>
      <h3>SHOW KRAVING: <%= kraving.name %> </h3>
    </div>

    <div id="map"></div>

     <div>
      <h4 id ="name">Name:</h4>
      <h4 id ="address">Address:</h4>
      <h4 id ="phone">Phone:</h4>
      <h4 id ="hours">Hours:</h4>
      <h4 id ="website">Website:</h4>
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-Y3EQPS2pywoCVD_9WsFZwWJb8uDx4BE&libraries=places&callback=initMap" async defer></script>

    <form class="Fav" action="/favs" method="post">
      <a href="/kravings/<%= kraving._id %>" class="btn btn-primary">Back</a>
      <a href="/kravings/" class="btn btn-primary">HOME</a>
      <button type="submit" class="btn btn-success">Save</button>
    </form>

 </main>

  <footer>
    <% include ../partials/footer %>
  </footer>
</body>
</html>
