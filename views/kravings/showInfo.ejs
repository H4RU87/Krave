<!DOCTYPE html>
<html lang="en">
<head>
  <% include ../partials/head %>
    <style>
   #map {
      width: 500px;
      height: 400px;
      background-color: #CCC;
      float: right;
    }
    </style>

    <script type="text/javascript" src="/javascripts/test.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.js"></script>

</head>

<body class="container-fluid">
  <header>
    <% include ../partials/header %>
  </header>

  <main>

    <div>
      <h3>SHOW INFO</h3>
    </div>

    <input id="pac-input" class="controls" type="text"
        placeholder="Enter a location">
    <div id="map"></div>

     <div>
      <h4 id ="name">Name:</h4>
      <h4 id ="address">Address:</h4>
      <h4 id ="phone">Phone:</h4>
      <h4 id ="hours">Hours:</h4>
      <h4 id ="website">Website:</h4>
    </div>

    <script>
      // This sample uses the Place Autocomplete widget to allow the user to search
      // for and select a place. The sample then displays an info window containing
      // the place ID and other information about the place that the user has
      // selected.

      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

      function getPlaceInfo (name, address, phone, hours, website) {

          $('#name').text('Name: ' + name);
          $('#address').text('Address: ' + address);
          $('#phone').text('Phone: ' + phone);
          $('#hours').text('Hours: ' + hours);
          $('#website').text('Website: ' + website);

      }

      function initMap() {

        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 33.7490, lng: -84.3880},
          zoom: 13
        });

        var input = document.getElementById('pac-input');
        var name = document.getElementById('name');

        var autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.bindTo('bounds', map);

        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        var infowindow = new google.maps.InfoWindow();
        var marker = new google.maps.Marker({
          map: map
        });
        marker.addListener('click', function() {
          infowindow.open(map, marker);
        });

        autocomplete.addListener('place_changed', function() {
          infowindow.close();
          place = autocomplete.getPlace();
          if (!place.geometry) {
            return;
          }

          if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
          } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);
          }

          // Set the position of the marker using the place ID and location.
          marker.setPlace({
            placeId: place.place_id,
            location: place.geometry.location
          });
          marker.setVisible(true);

          infowindow.setContent('<div><strong>' + place.name + '</strong><br>' +
              'Place ID: ' + place.place_id + '<br>' +
              place.formatted_address + '<br>' + place.formatted_phone_number + '<br>' + place.opening_hours.periods[0].open.time + ' - ' + place.opening_hours.periods[0].close.time  + '<br>' + place.website + '<br>');
          infowindow.open(map, marker);

          var open_to_close = place.opening_hours.periods[0].open.time + ' - ' + place.opening_hours.periods[0].close.time;

          getPlaceInfo(place.name, place.formatted_address, place.formatted_phone_number, open_to_close, place.website);

        });
      }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-Y3EQPS2pywoCVD_9WsFZwWJb8uDx4BE&libraries=places&callback=initMap" async defer></script>

    <a href="/kravings/<%= kraving._id %>" class="btn btn-primary">Back</a>
    <a href="/kravings/" class="btn btn-primary">HOME</a>

 </main>

  <footer>
    <% include ../partials/footer %>
  </footer>
</body>
</html>
